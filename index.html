<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© - Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠ Ø¨Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©">
    
    <!-- Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ iframe embedding -->
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' https://*.hostinger.com https://*.hstgr.io *;">
    
    <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBEe8xcUhmir1czwPivmXQs7lmXHizvwu0",
            authDomain: "medical-scheduling-syste-6fa11.firebaseapp.com",
            projectId: "medical-scheduling-syste-6fa11",
            storageBucket: "medical-scheduling-syste-6fa11.firebasestorage.app",
            messagingSenderId: "690280941209",
            appId: "1:690280941209:web:cff406b3010c1c89d59a08",
            measurementId: "G-S70M87BEY8"
        };
        
        try {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.firebaseReady = true;
            window.fbGetDocs = getDocs;
            window.fbCollection = collection;
            console.log('âœ… Firebase Connected!');
            
            document.addEventListener('DOMContentLoaded', () => {
                const statusDiv = document.getElementById('firebaseStatus');
                if (statusDiv) {
                    statusDiv.style.display = 'flex';
                    statusDiv.style.background = 'rgba(76,175,80,0.95)';
                    statusDiv.innerHTML = '<span style="font-size:1.2em">â˜ï¸</span><span>Ù…ØªØµÙ„</span>';
                }
            });
        } catch(error) {
            console.error('âŒ Firebase Error:', error);
            window.firebaseReady = false;
            document.addEventListener('DOMContentLoaded', () => {
                const statusDiv = document.getElementById('firebaseStatus');
                if (statusDiv) {
                    statusDiv.style.display = 'flex';
                    statusDiv.style.background = 'rgba(244,67,54,0.95)';
                    statusDiv.innerHTML = '<span>âš ï¸</span><span>ØºÙŠØ± Ù…ØªØµÙ„</span>';
                }
            });
        }
    </script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            direction: rtl;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: bounceIn 0.6s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .login-box h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .login-box h2 {
            color: #764ba2;
            margin-bottom: 30px;
            font-size: 1.2em;
            font-weight: normal;
        }

        .login-box .icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .login-error {
            color: #dc3545;
            margin-top: 10px;
            display: none;
        }

        #firebaseStatus {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(76,175,80,0.95);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 100;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            z-index: 100;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            max-width: 100%;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header h2 {
            font-size: 1.3em;
            font-weight: normal;
            opacity: 0.95;
        }

        .toolbar {
            background: #f8f9fa;
            padding: 15px 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 2px solid #e0e0e0;
        }

        .month-selector {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            color: #667eea;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .month-selector:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        .month-selector:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-upload {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #ffa726 50%, #ffb74d 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .cloud-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px;
            border-left: 5px solid #2196F3;
            box-shadow: 0 4px 15px rgba(33,150,243,0.2);
            display: none;
        }

        .cloud-info h3 {
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cloud-info p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .table-wrapper {
            overflow-x: auto;
            overflow-y: auto;
            padding: 20px;
            max-width: 100%;
            max-height: 70vh;
            position: relative;
        }

        table {
            border-collapse: collapse;
            font-size: 0.9em;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            width: auto;
        }

        th, td {
            padding: 10px 6px;
            text-align: center;
            border: 1px solid #e0e0e0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.85em;
        }

        td.status-cell {
            min-width: 60px;
            max-width: 80px;
            width: 70px;
        }

        .day-number {
            background: #f8f9fa;
            font-weight: bold;
            color: #667eea;
            font-size: 1em;
            min-width: 60px;
            max-width: 80px;
            width: 70px;
        }

        .day-name {
            background: #e9ecef;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            min-width: 60px;
            max-width: 80px;
            width: 70px;
        }

        .row-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            text-align: center;
            font-size: 1.1em;
            min-width: 100%;
        }

        .specialty-name {
            min-width: 250px;
            max-width: 350px;
            text-align: right;
            padding-right: 15px;
        }

        .hospital-name {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            font-size: 1em;
        }

        .section-title {
            background: #495057;
            color: white;
            font-weight: bold;
            text-align: right;
            padding-right: 15px;
        }

        .specialty-name {
            background: #f8f9fa;
            font-weight: 600;
            text-align: right;
            padding-right: 15px;
            color: #495057;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .specialty-name:hover {
            background: #e9ecef;
            transform: scale(1.02);
        }

        .editable-specialty::after {
            content: "âœï¸";
            position: absolute;
            left: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .editable-specialty:hover::after {
            opacity: 1;
        }

        .status-cell {
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .status-cell:hover {
            background: #e3f2fd;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .status-cell::after {
            content: "ğŸ”„";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8em;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .status-cell:hover::after {
            opacity: 1;
        }

        .status-not-applicable {
            color: #6c757d;
            font-style: italic;
        }

        .status-nmt {
            color: #ffc107;
            font-weight: bold;
        }

        .status-not-available {
            color: #dc3545;
            font-weight: bold;
        }

        .status-name {
            color: #28a745;
            font-weight: 600;
        }

        .friday {
            background: #fff3cd !important;
        }

        .saturday {
            background: #f8d7da !important;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 15px rgba(255, 193, 7, 0.5); }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            font-size: 1.3em;
            font-weight: bold;
        }

        .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-body label {
            display: block;
            margin-bottom: 10px;
            color: #495057;
            font-weight: 600;
        }

        .modal-body input, .modal-body select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
            margin-bottom: 20px;
        }

        .modal-body input:focus, .modal-body select:focus {
            outline: none;
            border-color: #667eea;
        }

        .quick-value-btn {
            flex: 1;
            min-width: 100px;
        }

        .modal-footer {
            padding: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            border-top: 1px solid #e0e0e0;
        }

        .close-btn {
            background: #6c757d;
            color: white;
        }

        .btn-delete {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .doctor-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .doctor-item {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .doctor-item:hover {
            background: #e3f2fd;
        }

        .doctor-item:last-child {
            border-bottom: none;
        }

        .specialty-info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }

        .email-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .email-option:hover {
            background: #f8f9fa;
            border-color: #667eea;
            transform: translateX(-5px);
        }

        .email-option input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .upload-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .upload-info h4 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .upload-info ul {
            margin: 0;
            padding-right: 20px;
            color: #495057;
        }

        .upload-info li {
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            body { padding: 5px; }
            .login-box { padding: 25px; width: 95%; }
            .login-box h1 { font-size: 1.5em; }
            .login-box h2 { font-size: 1em; }
            .login-box .icon { font-size: 3em; }
            .header { padding: 15px 10px; }
            .header h1 { font-size: 1.3em; margin-bottom: 5px; }
            .header h2 { font-size: 0.9em; }
            .logout-btn { top: 10px; left: 10px; padding: 5px 10px; font-size: 0.75em; }
            .toolbar { padding: 10px; gap: 8px; flex-direction: column; }
            .month-selector { width: 100%; padding: 12px; font-size: 1em; }
            .btn { width: 100%; padding: 12px; font-size: 0.95em; justify-content: center; }
            .table-wrapper { padding: 5px; max-height: 60vh; }
            table { font-size: 0.7em; }
            th, td { padding: 8px 4px; font-size: 0.85em; }
            .specialty-name { min-width: 120px; max-width: 150px; width: 140px; font-size: 0.8em; padding-right: 8px; }
            .day-number, .day-name, td.status-cell { min-width: 50px; max-width: 70px; width: 60px; font-size: 0.75em; padding: 6px 2px; }
            .modal-content { width: 95%; margin: 5% auto; max-height: 90vh; overflow-y: auto; }
            .modal-header { padding: 15px; font-size: 1.1em; }
            .modal-body { padding: 15px; max-height: 60vh; }
            .modal-footer { padding: 15px; flex-direction: column; }
            .modal-footer .btn { width: 100%; margin-bottom: 8px; }
            .status-cell:hover { transform: none; box-shadow: none; }
            .specialty-name:hover { transform: none; }
            .btn:hover { transform: none; }
            .container { border-radius: 10px; }
        }

        @media (max-width: 480px) {
            .header h1 { font-size: 1.1em; }
            .header h2 { font-size: 0.8em; }
            .specialty-name { min-width: 100px; max-width: 120px; width: 110px; font-size: 0.7em; }
            .day-number, .day-name, td.status-cell { min-width: 40px; max-width: 55px; width: 48px; font-size: 0.7em; padding: 5px 2px; }
            table { font-size: 0.65em; }
            .logout-btn { padding: 4px 8px; font-size: 0.7em; }
        }

        @media (max-width: 900px) and (orientation: landscape) {
            .table-wrapper { max-height: 55vh; }
            .modal-content { max-height: 85vh; }
            .modal-body { max-height: 50vh; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="icon">ğŸ”</div>
            <h1>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</h1>
            <h2>Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠ Ø¨Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©</h2>
            <input type="password" id="passwordInput" class="login-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ" onkeypress="if(event.key==='Enter') login()">
            <button class="login-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
            <div class="login-error" id="loginError">âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­</div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <div id="firebaseStatus"></div>
            <button class="logout-btn" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            <h1>ğŸ¥ Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­ÙŠ Ø¨Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©</h1>
            <h2 id="headerTitle">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© Ù„Ø´Ù‡Ø± Ø£ÙƒØªÙˆØ¨Ø± 2025</h2>
            <div id="saveStatus" style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;"></div>
        </div>

        <div class="toolbar">
            <div style="display: flex; align-items: center; gap: 10px;">
                <label style="font-weight: 600; color: #495057;">ğŸ“… Ø§Ù„Ø´Ù‡Ø±:</label>
                <select id="monthSelector" class="month-selector" onchange="changeMonth()">
                    <option value="1">ÙŠÙ†Ø§ÙŠØ± 2025</option>
                    <option value="2">ÙØ¨Ø±Ø§ÙŠØ± 2025</option>
                    <option value="3">Ù…Ø§Ø±Ø³ 2025</option>
                    <option value="4">Ø£Ø¨Ø±ÙŠÙ„ 2025</option>
                    <option value="5">Ù…Ø§ÙŠÙˆ 2025</option>
                    <option value="6">ÙŠÙˆÙ†ÙŠÙˆ 2025</option>
                    <option value="7">ÙŠÙˆÙ„ÙŠÙˆ 2025</option>
                    <option value="8">Ø£ØºØ³Ø·Ø³ 2025</option>
                    <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø± 2025</option>
                    <option value="10" selected>Ø£ÙƒØªÙˆØ¨Ø± 2025</option>
                    <option value="11">Ù†ÙˆÙÙ…Ø¨Ø± 2025</option>
                    <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø± 2025</option>
                </select>
            </div>
            <button class="btn btn-warning" onclick="loadScheduleFromCloud()">
                <span>â˜ï¸</span>
                <span>Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</span>
            </button>
            <button class="btn btn-info" onclick="showAllSchedules()">
                <span>ğŸ“š</span>
                <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</span>
            </button>
            <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()">
                <span>ğŸ“¤</span>
                <span>Ø±ÙØ¹ Ø¬Ø¯ÙˆÙ„</span>
            </button>
            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleFileUpload(event)">
            <button class="btn btn-success" onclick="exportToExcel()">
                <span>ğŸ“¥</span>
                <span>ØªÙ†Ø²ÙŠÙ„ Excel</span>
            </button>
            <button class="btn btn-info" onclick="showEmailModal()">
                <span>ğŸ“§</span>
                <span>Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯</span>
            </button>
            <button class="btn btn-primary" onclick="addDoctor()">
                <span>â•</span>
                <span>Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨</span>
            </button>
            <button class="btn btn-primary" onclick="addSpecialty()">
                <span>ğŸ¥</span>
                <span>Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ</span>
            </button>
            <button class="btn btn-success" onclick="saveData()" title="Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
                <span>ğŸ’¾</span>
                <span>Ø­ÙØ¸</span>
            </button>
            <button class="btn btn-primary" onclick="restoreOriginalSchedule()" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„">
                <span>ğŸ”™</span>
                <span>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ</span>
            </button>
            <button class="btn btn-delete" onclick="clearSavedData()" title="Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†">
                <span>ğŸ—‘ï¸</span>
                <span>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
            </button>
        </div>

        <div class="cloud-info" id="cloudInfo">
            <h3>â˜ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</h3>
            <p id="cloudInfoText"></p>
        </div>
        
        <div class="table-wrapper">
            <table id="scheduleTable"></table>
        </div>
    </div>

    <!-- Modals -->
    <div id="doctorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ØªØºÙŠÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨</div>
            <div class="modal-body">
                <div class="specialty-info" id="currentSpecialty"></div>
                
                <label>Ø§Ø®ØªØ± Ø·Ø¨ÙŠØ¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:</label>
                <div class="doctor-list" id="doctorList"></div>
                
                <label>Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯:</label>
                <input type="text" id="newDoctorName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨">
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 2px dashed #667eea;">
                    <label style="font-weight: bold; margin-bottom: 10px; display: block; color: #667eea;">âš¡ Ø®ÙŠØ§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©:</label>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                        <button type="button" onclick="setQuickValue('Not available')" style="padding: 10px; border: none; border-radius: 8px; background: linear-gradient(135deg, #f5576c 0%, #e94560 100%); color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            âŒ Not available
                        </button>
                        <button type="button" onclick="setQuickValue('NMT')" style="padding: 10px; border: none; border-radius: 8px; background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            âš ï¸ NMT
                        </button>
                        <button type="button" onclick="setQuickValue('')" style="padding: 10px; border: none; border-radius: 8px; background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            ğŸ—‘ï¸ Ù…Ø³Ø­
                        </button>
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-top: 20px; border-right: 4px solid #ffc107;">
                    <label style="font-weight: bold; margin-bottom: 10px; display: block; color: #856404;">ğŸ“ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</label>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 5px; transition: all 0.3s; background: rgba(255,255,255,0.5);">
                            <input type="radio" name="applyScope" value="single" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span><strong>ğŸ“ Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</strong><br><small style="color: #856404;">Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø­Ø§Ù„ÙŠ - Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ</small></span>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 5px; transition: all 0.3s; background: rgba(255,255,255,0.5);">
                            <input type="radio" name="applyScope" value="day" style="width: 18px; height: 18px; cursor: pointer;">
                            <span><strong>ğŸ“… ÙƒØ§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…</strong><br><small style="color: #856404;">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª - Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…</small></span>
                        </label>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 5px; transition: all 0.3s; background: rgba(255,255,255,0.5);">
                            <input type="radio" name="applyScope" value="month" style="width: 18px; height: 18px; cursor: pointer;">
                            <span><strong>ğŸ—“ï¸ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ù‡Ø±</strong><br><small style="color: #856404;">Ù†ÙØ³ Ø§Ù„ØªØ®ØµØµ - Ø¬Ù…ÙŠØ¹ Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø±</small></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn save-btn" onclick="saveDoctorChange()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div id="specialtyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</div>
            <div class="modal-body">
                <label>Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                <input type="text" id="specialtyNameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ">
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn save-btn" onclick="saveSpecialtyChange()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div id="addDoctorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ Ø¬Ø¯ÙŠØ¯</div>
            <div class="modal-body">
                <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨:</label>
                <input type="text" id="addDoctorNameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨">
                <label>Ø§Ù„ØªØ®ØµØµ:</label>
                <select id="addDoctorSpecialty">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                </select>
                <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 0.9em;">
                    ğŸ’¡ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø·Ø¨Ø§Ø¡ ÙÙ‚Ø·
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn save-btn" onclick="saveNewDoctor()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>
    </div>

    <div id="addSpecialtyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ğŸ¥ Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯</div>
            <div class="modal-body">
                <label>Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ:</label>
                <input type="text" id="newSpecialtyNameInput" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø£Ø¹ØµØ§Ø¨">
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-right: 4px solid #667eea;">
                    <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong>
                    <ul style="margin-top: 10px; padding-right: 20px;">
                        <li>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ ÙƒØ³Ø·Ø± Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</li>
                        <li>ÙŠÙ…ÙƒÙ†Ùƒ Ø¨Ø¹Ø¯Ù‡Ø§ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn save-btn" onclick="saveNewSpecialty()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>
    </div>

    <div id="emailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª</div>
            <div class="modal-body">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="recipientEmail" placeholder="example@moh.gov.sa">
                <label>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</label>
                <div class="email-option" onclick="selectEmailOption('gmail')">
                    <input type="radio" name="emailService" value="gmail" id="gmailOption">
                    <label for="gmailOption" style="cursor: pointer; margin: 0;">
                        <strong>Gmail</strong> - Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø¬ÙŠÙ…ÙŠÙ„
                    </label>
                </div>
                <div class="email-option" onclick="selectEmailOption('owa')">
                    <input type="radio" name="emailService" value="owa" id="owaOption">
                    <label for="owaOption" style="cursor: pointer; margin: 0;">
                        <strong>OWA</strong> - Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø¨Ø±ÙŠØ¯ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn save-btn" onclick="sendEmail()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>

    <div id="uploadOptionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ğŸ“¤ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨</div>
            <div class="modal-body">
                <div class="upload-info">
                    <h4>âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!</h4>
                    <ul>
                        <li>ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ®ØµØµØ§Øª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</li>
                        <li>ÙŠØªØ¹Ø±Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø£ÙŠØ§Ù…</li>
                        <li>ÙŠÙ…Ù„Ø£ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</li>
                    </ul>
                </div>
                <label>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡:</label>
                <div class="email-option" onclick="selectOnCallType('first')">
                    <input type="radio" name="onCallType" value="first" id="firstOnCallOption" checked>
                    <label for="firstOnCallOption" style="cursor: pointer; margin: 0;">
                        <strong>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø£ÙˆÙ„</strong> - First on Call
                    </label>
                </div>
                <div class="email-option" onclick="selectOnCallType('second')">
                    <input type="radio" name="onCallType" value="second" id="secondOnCallOption">
                    <label for="secondOnCallOption" style="cursor: pointer; margin: 0;">
                        <strong>Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</strong> - Second on Call
                    </label>
                </div>
                <div class="email-option" onclick="selectOnCallType('both')">
                    <input type="radio" name="onCallType" value="both" id="bothOnCallOption">
                    <label for="bothOnCallOption" style="cursor: pointer; margin: 0;">
                        <strong>ÙƒÙ„Ø§Ù‡Ù…Ø§</strong> - ÙƒÙ„Ø§ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ÙŠÙ† (Ø³ÙŠØªÙ… Ø¯Ù…Ø¬Ù‡Ù…)
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn save-btn" onclick="processUploadedFile()">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            </div>
        </div>
    </div>

    <div id="allSchedulesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ğŸ“š Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</div>
            <div class="modal-body">
                <div id="allSchedulesList" style="max-height: 400px; overflow-y: auto;">
                    <p style="text-align: center; color: #666;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn close-btn" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        const CORRECT_PASSWORD = '1147';
        
        function login() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === CORRECT_PASSWORD) {
                localStorage.setItem('scheduleLogin', 'true');
                errorDiv.style.display = 'none';
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                initializeApp();
            } else {
                errorDiv.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function logout() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('scheduleLogin');
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('passwordInput').value = '';
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            const savedLogin = localStorage.getItem('scheduleLogin');
            if (savedLogin === 'true') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                initializeApp();
            }
        });

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let data = [];
        let specialtyDoctors = {};
        let currentRow = -1;
        let currentCol = -1;
        let currentSpecialtyRow = -1;
        let selectedEmailService = '';
        let currentMonth = 10;
        let currentYear = 2025;
        let uploadedFileData = null;
        let selectedOnCallType = 'first';

        const monthNames = {
            1: 'ÙŠÙ†Ø§ÙŠØ±', 2: 'ÙØ¨Ø±Ø§ÙŠØ±', 3: 'Ù…Ø§Ø±Ø³', 4: 'Ø£Ø¨Ø±ÙŠÙ„',
            5: 'Ù…Ø§ÙŠÙˆ', 6: 'ÙŠÙˆÙ†ÙŠÙˆ', 7: 'ÙŠÙˆÙ„ÙŠÙˆ', 8: 'Ø£ØºØ³Ø·Ø³',
            9: 'Ø³Ø¨ØªÙ…Ø¨Ø±', 10: 'Ø£ÙƒØªÙˆØ¨Ø±', 11: 'Ù†ÙˆÙÙ…Ø¨Ø±', 12: 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
        };

        const dayNames = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];

        const specialtyTranslation = {
            'urology': 'Ø§Ù„Ù…Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨ÙˆÙ„ÙŠØ©',
            'Ø§Ù„Ù…Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨ÙˆÙ„ÙŠØ©': 'Ø§Ù„Ù…Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨ÙˆÙ„ÙŠØ©',
            'cardiology': 'Ù‚Ù„Ø¨ ÙƒØ¨Ø§Ø±',
            'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨': 'Ù‚Ù„Ø¨ ÙƒØ¨Ø§Ø±',
            'neurology': 'Ø§Ù…Ø±Ø§Ø¶ Ù…Ø® ÙˆØ£Ø¹ØµØ§Ø¨ Ø¨Ø§Ø·Ù†ÙŠØ© ÙƒØ¨Ø§Ø±',
            'orthopedics': 'Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹Ø¸Ø§Ù…',
            'pediatrics': 'Ø£Ø·ÙØ§Ù„ Ø¹Ø§Ù…',
            'general surgery': 'Ø§Ù„Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©',
            'ent': 'Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø£Ù†Ù ÙˆØ§Ù„Ø­Ù†Ø¬Ø±Ø© ÙˆØ§Ù„Ø±Ø£Ø³ ÙˆØ§Ù„Ø¹Ù†Ù‚ ( ÙƒØ¨Ø§Ø±)',
            'ophthalmology': 'Ø·Ø¨ ÙˆØ¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹ÙŠÙˆÙ† Ø¹Ø§Ù…',
            'internal medicine': 'Ø§Ù„Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¨Ø§Ø·Ù†ÙŠØ©',
            'anesthesia': 'Ø§Ù„ØªØ®Ø¯ÙŠØ± ÙƒØ¨Ø§Ø±'
        };

        function initializeApp() {
            initializeData();
            const hasLoadedData = loadSavedData();
            if (!hasLoadedData) {
                console.log('ğŸ“‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ');
            }
            buildSpecialtyDoctors();
            buildTable();
            showSaveStatus();
        }

        function initializeData() {
            data = [
                ["Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­Ù‰ Ø¨Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31],
                ["", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø§Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ø§Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø§Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ø§Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø§Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ø§Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø§Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ø§Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"],
                ["Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø¨Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ù† Ø¬Ù„ÙˆÙŠ ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ", "Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ"],
                ["Ø§Ù„ØªØ®ØµØµØ§Øª", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø£Ø·ÙØ§Ù„ Ø¹Ø§Ù…", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["ØºØ¯Ø¯ ØµÙ…Ø§Ø¡ Ø§Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ù…Ù†Ø§Ø¸ÙŠØ± Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù‡Ø¶Ù…ÙŠ", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT"],
                ["Ù…Ù†Ø§Ø¸ÙŠØ± Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø±Ø§Ø±ÙŠØ©", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available"],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ø·ÙØ§Ù„", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT"],
                ["Ø¬Ù‡Ø§Ø² Ù‡Ø¶Ù…ÙŠ Ø§Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ù…Ø¹Ø¯ÙŠØ© Ø§Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ø¹ØµØ§Ø¨ Ø§Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["ÙƒÙ„Ù‰ Ø§Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ø§Ø³ØªÙ‚Ù„Ø§Ø¨ÙŠØ© Ø§Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ù‚Ù„Ø¨ Ø£Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ù‚Ù„Ø¨ ÙƒØ¨Ø§Ø±", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB"],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„ØµØ¯Ø±", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT", "NMT"],
                ["Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø© Ù„Ø­Ø¯ÙŠØ«ÙŠ Ø§Ù„ÙˆÙ„Ø§Ø¯Ù‡", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„ÙˆØ¬Ù‡ ÙˆØ§Ù„ÙÙƒÙŠÙ†", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ù…Ø±ÙƒØ² Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ­Ø§Ù„Ø§Øª Ø§Ù„Ù‚Ø³Ø·Ø±Ø© Ø§Ù„Ù‚Ù„Ø¨ÙŠØ©", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB", "Reema", "MAHTAB"],
                ["Ø§Ù…Ø±Ø§Ø¶ Ù…Ø® ÙˆØ£Ø¹ØµØ§Ø¨ Ø¨Ø§Ø·Ù†ÙŠØ© ÙƒØ¨Ø§Ø±", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali", "Mahmed Ali"],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø£Ù†Ù ÙˆØ§Ù„Ø­Ù†Ø¬Ø±Ø© ÙˆØ§Ù„Ø±Ø£Ø³ ÙˆØ§Ù„Ø¹Ù†Ù‚ (Ø£Ø·ÙØ§Ù„)", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama", "Saleh", "Usama"],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø£Ù†Ù ÙˆØ§Ù„Ø­Ù†Ø¬Ø±Ø© ÙˆØ§Ù„Ø±Ø£Ø³ ÙˆØ§Ù„Ø¹Ù†Ù‚ (ÙƒØ¨Ø§Ø±)", "Mahmoud", "Saleh", "Mahmoud", "saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud", "Saleh", "Mahmoud"],
                ["Ø¬Ø±Ø§Ø­Ø© Ù…Ø® ÙˆØ§Ø¹ØµØ§Ø¨ ÙƒØ¨Ø§Ø±", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø¬Ø±Ø§Ø­Ø© Ù…Ø® ÙˆØ§Ø¹ØµØ§Ø¨ Ø£Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["ØºØ³ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù‰", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„ÙƒÙ„Ù‰ ÙƒØ¨Ø§Ø±", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical", "Aliaa", "medical"],
                ["Ù†Ø³Ø§Ø¡ ÙˆÙˆÙ„Ø§Ø¯Ø©", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¯Ù… Ø£Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¯Ù… ÙƒØ¨Ø§Ø±", "Rama", "Eiharith", "Eiharith", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama", "Eiharith", "Rama"],
                ["Ø§Ù„Ø¬Ø±Ø§Ø­Ø© Ø§Ù„ØªØ¬Ù…ÙŠÙ„ÙŠØ© ÙˆØ§Ù„Ø­Ø±ÙˆÙ‚", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["ØºØ¯Ø¯ ØµÙ…Ø§Ø¡ ÙˆØ§Ù…Ø±Ø§Ø¶ Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ø¨ ÙƒØ¨Ø§Ø±", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir", "Bashir"],
                ["Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„ÙƒØ¨Ø§Ø±", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available", "Not available"],
                ["Ø§Ù„Ø§Ø´Ø¹Ø© Ø§Ù„ØªØ¯Ø§Ø®Ù„ÙŠØ©", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹Ø¸Ø§Ù…", "aymen", "abdelkafi", "abdelkafi", "tawfik", "hisham", "tawfik", "hisham", "hisham", "aymen", "abdelkafi", "tawfik", "hisham", "hisham", "aymen", "abdelkafi", "tawfik", "hisham", "hisham", "aymen", "abdelkafi", "tawfik", "hisham", "hisham", "aymen", "abdelkafi", "tawfik", "hisham", "hisham", "aymen", "abdelkafi", "tawfik"],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ù‚Ù„Ø¨", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø§ÙˆØ¹ÙŠØ© Ø§Ù„Ø¯Ù…ÙˆÙŠØ©", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø§ÙˆØ¹ÙŠØ© Ø§Ù„Ø¯Ù…ÙˆÙŠØ© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© (Microvascular)", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["ÙˆØ­Ø¯Ø© Ø§Ù„Ø­Ø±ÙˆÙ‚", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù„Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©", "RAHMA", "MAGDY", "YASSER", "MARYAM", "Majdi", "MAGDY", "Majdi", "MAGDY", "RAHMA", "MAGDY", "MARYAM", "Majdi", "MAGDY", "RAHMA", "MAGDY", "MARYAM", "Majdi", "MAGDY", "RAHMA", "MAGDY", "MARYAM", "Majdi", "MAGDY", "RAHMA", "MAGDY", "MARYAM", "Majdi", "MAGDY", "RAHMA", "MAGDY", "MARYAM"],
                ["Ø§Ù„Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„ØµØ¯Ø±ÙŠØ©", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman", "medical", "Eman"],
                ["Ø§Ù„Ø§Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¨Ø§Ø·Ù†ÙŠØ©", "Amany", "kamel", "Yasser", "Amany", "marzouk", "kamel", "Yasser", "kamel", "Amany", "kamel", "Amany", "marzouk", "kamel", "Amany", "kamel", "Amany", "marzouk", "kamel", "Amany", "kamel", "Amany", "marzouk", "kamel", "Amany", "kamel", "Amany", "marzouk", "kamel", "Amany", "kamel", "Amany"],
                ["Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙÙ‚Ø±ÙŠ", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø§Ù…Ø±Ø§Ø¶ Ù…Ø¹Ø¯ÙŠØ© ÙƒØ¨Ø§Ø±", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["stroke unit", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["Ø·Ø¨ ÙˆØ¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹ÙŠÙˆÙ† Ø¹Ø§Ù…", "Yasser", "Maram", "Ashraf", "Yasser", "Hany", "Maram", "Ashraf", "Maram", "Yasser", "Maram", "Yasser", "Hany", "Maram", "Yasser", "Maram", "Yasser", "Hany", "Maram", "Yasser", "Maram", "Yasser", "Hany", "Maram", "Yasser", "Maram", "Yasser", "Hany", "Maram", "Yasser", "Maram", "Yasser"],
                ["Ø§Ù„ØªØ®Ø¯ÙŠØ± ÙƒØ¨Ø§Ø±", "Haifa", "latifa", "ruiz", "Egra", "Haifa", "latifa", "ruiz", "latifa", "Haifa", "latifa", "Egra", "Haifa", "latifa", "Haifa", "latifa", "Egra", "Haifa", "latifa", "Haifa", "latifa", "Egra", "Haifa", "latifa", "Haifa", "latifa", "Egra", "Haifa", "latifa", "Haifa", "latifa", "Egra"],
                ["Ø§Ù„Ù…Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨ÙˆÙ„ÙŠØ©", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
            ];
        }

        function getDaysInMonth(month, year) {
            return new Date(year, month, 0).getDate();
        }

        function getDayName(day, month, year) {
            const date = new Date(year, month - 1, day);
            return dayNames[date.getDay()];
        }

        function buildSpecialtyDoctors() {
            specialtyDoctors = {};
            data.forEach((row, rowIndex) => {
                if (rowIndex > 3) {
                    const specialty = row[0];
                    specialtyDoctors[specialty] = new Set();
                    row.forEach((cell, colIndex) => {
                        if (colIndex > 0 && cell && cell.toString().match(/[a-zA-Z]/) && 
                            cell !== 'not applicable' && cell !== 'NMT' && 
                            cell !== 'Not available' && cell !== 'Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ') {
                            specialtyDoctors[specialty].add(cell.trim());
                        }
                    });
                    specialtyDoctors[specialty] = Array.from(specialtyDoctors[specialty]).sort();
                }
            });
        }

        function getCellClass(value) {
            if (!value || value === '') return 'status-cell';
            const lowerValue = value.toString().toLowerCase();
            if (lowerValue === 'not applicable') return 'status-cell status-not-applicable';
            if (lowerValue === 'nmt') return 'status-cell status-nmt';
            if (lowerValue.includes('not available')) return 'status-cell status-not-available';
            if (value.toString().match(/[a-zA-Z]/)) return 'status-cell status-name';
            return 'status-cell';
        }

        function buildTable() {
            const table = document.getElementById('scheduleTable');
            table.innerHTML = '';
            
            data.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                
                row.forEach((cell, cellIndex) => {
                    let element;
                    
                    if (rowIndex === 0 && cellIndex === 0) {
                        element = document.createElement('th');
                        element.className = 'specialty-name';
                        element.textContent = cell;
                    } else if (rowIndex === 0) {
                        element = document.createElement('th');
                        element.className = 'day-number';
                        const dayName = data[1][cellIndex];
                        if (dayName === 'Ø§Ù„Ø¬Ù…Ø¹Ø©') element.classList.add('friday');
                        if (dayName === 'Ø§Ù„Ø³Ø¨Øª') element.classList.add('saturday');
                        element.textContent = cell;
                    } else if (rowIndex === 1 && cellIndex === 0) {
                        element = document.createElement('th');
                        element.className = 'specialty-name';
                        element.textContent = '';
                    } else if (rowIndex === 1) {
                        element = document.createElement('th');
                        element.className = 'day-name';
                        if (cell === 'Ø§Ù„Ø¬Ù…Ø¹Ø©') element.classList.add('friday');
                        if (cell === 'Ø§Ù„Ø³Ø¨Øª') element.classList.add('saturday');
                        element.textContent = cell;
                    } else if (rowIndex === 2 && cellIndex === 0) {
                        element = document.createElement('th');
                        element.className = 'hospital-name';
                        element.textContent = cell;
                    } else if (rowIndex === 2) {
                        element = document.createElement('th');
                        element.className = 'hospital-name';
                        element.textContent = cell;
                    } else if (rowIndex === 3 && cellIndex === 0) {
                        element = document.createElement('th');
                        element.className = 'section-title';
                        element.textContent = cell;
                    } else if (rowIndex === 3) {
                        element = document.createElement('th');
                        element.className = 'section-title';
                        element.textContent = '';
                    } else if (cellIndex === 0) {
                        element = document.createElement('th');
                        element.className = 'specialty-name editable-specialty';
                        element.onclick = function() {
                            editSpecialty(rowIndex);
                        };
                        element.textContent = cell;
                    } else {
                        element = document.createElement('td');
                        element.className = getCellClass(cell);
                        const dayName = data[1][cellIndex];
                        if (dayName === 'Ø§Ù„Ø¬Ù…Ø¹Ø©') element.classList.add('friday');
                        if (dayName === 'Ø§Ù„Ø³Ø¨Øª') element.classList.add('saturday');
                        if (rowIndex > 3) {
                            element.onclick = function() {
                                editDoctor(rowIndex, cellIndex);
                            };
                        }
                        element.textContent = cell;
                    }
                    
                    tr.appendChild(element);
                });
                
                table.appendChild(tr);
            });
        }

        function editDoctor(row, col) {
            currentRow = row;
            currentCol = col;
            const specialty = data[row][0];
            const dayName = data[1][col];
            const dayNumber = data[0][col];
            document.getElementById('currentSpecialty').textContent = `ğŸ“‹ Ø§Ù„ØªØ®ØµØµ: ${specialty} | ğŸ“… Ø§Ù„ÙŠÙˆÙ…: ${dayName} ${dayNumber}`;
            
            const modal = document.getElementById('doctorModal');
            const doctorList = document.getElementById('doctorList');
            doctorList.innerHTML = '';
            const doctors = specialtyDoctors[specialty] || [];
            if (doctors.length > 0) {
                doctors.forEach(doctor => {
                    const div = document.createElement('div');
                    div.className = 'doctor-item';
                    div.textContent = doctor;
                    div.onclick = function() {
                        document.getElementById('newDoctorName').value = doctor;
                    };
                    doctorList.appendChild(div);
                });
            } else {
                const div = document.createElement('div');
                div.className = 'doctor-item';
                div.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø·Ø¨Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ';
                div.style.textAlign = 'center';
                div.style.color = '#999';
                div.style.cursor = 'default';
                doctorList.appendChild(div);
            }
            document.getElementById('newDoctorName').value = data[row][col];
            
            document.querySelector('input[name="applyScope"][value="single"]').checked = true;
            
            modal.style.display = 'block';
        }

        function saveDoctorChange() {
            const newName = document.getElementById('newDoctorName').value.trim();
            const applyScope = document.querySelector('input[name="applyScope"]:checked').value;
            
            if (currentRow >= 0 && currentCol >= 0) {
                let count = 0;
                let message = '';
                
                if (applyScope === 'single') {
                    data[currentRow][currentCol] = newName;
                    const specialty = data[currentRow][0];
                    if (!specialtyDoctors[specialty]) {
                        specialtyDoctors[specialty] = [];
                    }
                    if (newName && !specialtyDoctors[specialty].includes(newName) && 
                        newName !== 'not applicable' && 
                        newName !== 'NMT' && 
                        newName !== 'Not available') {
                        specialtyDoctors[specialty].push(newName);
                        specialtyDoctors[specialty].sort();
                    }
                    message = `âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!`;
                    
                } else if (applyScope === 'day') {
                    for (let i = 4; i < data.length; i++) {
                        data[i][currentCol] = newName;
                        count++;
                        
                        const specialty = data[i][0];
                        if (newName && newName !== 'Not available' && newName !== 'NMT' && newName !== 'not applicable' && newName !== '') {
                            if (!specialtyDoctors[specialty]) {
                                specialtyDoctors[specialty] = [];
                            }
                            if (!specialtyDoctors[specialty].includes(newName)) {
                                specialtyDoctors[specialty].push(newName);
                                specialtyDoctors[specialty].sort();
                            }
                        }
                    }
                    const displayValue = newName === '' ? 'ÙØ§Ø±Øº' : newName;
                    message = `âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ "${displayValue}" Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ… ${data[1][currentCol]}\nğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª: ${count}`;
                    
                } else if (applyScope === 'month') {
                    const specialty = data[currentRow][0];
                    for (let col = 1; col < data[currentRow].length; col++) {
                        data[currentRow][col] = newName;
                        count++;
                    }
                    
                    if (newName && newName !== 'Not available' && newName !== 'NMT' && newName !== 'not applicable' && newName !== '') {
                        if (!specialtyDoctors[specialty]) {
                            specialtyDoctors[specialty] = [];
                        }
                        if (!specialtyDoctors[specialty].includes(newName)) {
                            specialtyDoctors[specialty].push(newName);
                            specialtyDoctors[specialty].sort();
                        }
                    }
                    
                    const displayValue = newName === '' ? 'ÙØ§Ø±Øº' : newName;
                    const daysInMonth = getDaysInMonth(currentMonth, currentYear);
                    message = `âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ "${displayValue}" Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ù‡Ø±\nğŸ“‹ Ø§Ù„ØªØ®ØµØµ: ${specialty}\nğŸ“… Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: ${daysInMonth}`;
                }
                
                buildTable();
                closeModal();
                
                if (message) {
                    alert(message);
                }
                
                autoSave();
            }
        }

        function setQuickValue(value) {
            document.getElementById('newDoctorName').value = value;
            if (value === '' || value === 'Not available' || value === 'NMT') {
                const radioButtons = document.querySelectorAll('input[name="applyScope"]');
                radioButtons.forEach(radio => {
                    if (radio.value !== 'single') {
                        radio.parentElement.style.animation = 'pulse 0.5s';
                        setTimeout(() => {
                            radio.parentElement.style.animation = '';
                        }, 500);
                    }
                });
            }
        }

        function editSpecialty(row) {
            currentSpecialtyRow = row;
            const specialty = data[row][0];
            
            const message = "Ø§Ù„ØªØ®ØµØµ: " + specialty + "\n\n" +
                           "Ø§Ø®ØªØ± Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„:\n\n" +
                           "1 - ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ\n" +
                           "2 - ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©\n\n" +
                           "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø®ÙŠØ§Ø± (1 Ø£Ùˆ 2):";
            
            const choice = prompt(message);
            
            if (choice === '1') {
                const modal = document.getElementById('specialtyModal');
                document.getElementById('specialtyNameInput').value = specialty;
                modal.style.display = 'block';
            } else if (choice === '2') {
                loadCloudDataForSpecialty(row, specialty);
            }
        }

        function saveSpecialtyChange() {
            const newName = document.getElementById('specialtyNameInput').value.trim();
            if (newName && currentSpecialtyRow >= 0) {
                const oldName = data[currentSpecialtyRow][0];
                data[currentSpecialtyRow][0] = newName;
                if (specialtyDoctors[oldName]) {
                    specialtyDoctors[newName] = specialtyDoctors[oldName];
                    delete specialtyDoctors[oldName];
                }
                buildTable();
                closeModal();
                autoSave();
            }
        }

        function addDoctor() {
            const modal = document.getElementById('addDoctorModal');
            const select = document.getElementById('addDoctorSpecialty');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>';
            const specialtiesWithDoctors = [];
            data.forEach((row, index) => {
                if (index > 3) {
                    const specialty = row[0];
                    if (specialtyDoctors[specialty] && specialtyDoctors[specialty].length > 0) {
                        specialtiesWithDoctors.push(specialty);
                    }
                }
            });
            if (specialtiesWithDoctors.length === 0) {
                data.forEach((row, index) => {
                    if (index > 3) {
                        const option = document.createElement('option');
                        option.value = row[0];
                        option.textContent = row[0];
                        select.appendChild(option);
                    }
                });
            } else {
                specialtiesWithDoctors.forEach(specialty => {
                    const option = document.createElement('option');
                    option.value = specialty;
                    option.textContent = `${specialty} (${specialtyDoctors[specialty].length} Ø·Ø¨ÙŠØ¨)`;
                    select.appendChild(option);
                });
            }
            document.getElementById('addDoctorNameInput').value = '';
            modal.style.display = 'block';
        }

        function saveNewDoctor() {
            const name = document.getElementById('addDoctorNameInput').value.trim();
            const specialty = document.getElementById('addDoctorSpecialty').value;
            if (name && specialty) {
                if (!specialtyDoctors[specialty]) {
                    specialtyDoctors[specialty] = [];
                }
                if (!specialtyDoctors[specialty].includes(name)) {
                    specialtyDoctors[specialty].push(name);
                    specialtyDoctors[specialty].sort();
                    autoSave();
                    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨: ' + name + '\nØ¥Ù„Ù‰ ØªØ®ØµØµ: ' + specialty);
                    closeModal();
                } else {
                    alert('Ø§Ù„Ø·Ø¨ÙŠØ¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ');
                }
            } else {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ®ØµØµ');
            }
        }

        function addSpecialty() {
            const modal = document.getElementById('addSpecialtyModal');
            document.getElementById('newSpecialtyNameInput').value = '';
            modal.style.display = 'block';
        }

        function saveNewSpecialty() {
            const specialtyName = document.getElementById('newSpecialtyNameInput').value.trim();
            if (!specialtyName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ');
                return;
            }
            let exists = false;
            for (let i = 4; i < data.length; i++) {
                if (data[i][0].toLowerCase().trim() === specialtyName.toLowerCase().trim()) {
                    exists = true;
                    break;
                }
            }
            if (exists) {
                alert('Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„');
                return;
            }
            const daysInMonth = getDaysInMonth(currentMonth, currentYear);
            const newRow = [specialtyName];
            for (let i = 0; i < daysInMonth; i++) {
                newRow.push('');
            }
            data.push(newRow);
            specialtyDoctors[specialtyName] = [];
            buildTable();
            closeModal();
            autoSave();
            alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ: ${specialtyName}\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø¶Ø§ÙØ© Ø£Ø·Ø¨Ø§Ø¡ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ`);
        }

        function closeModal() {
            document.getElementById('doctorModal').style.display = 'none';
            document.getElementById('specialtyModal').style.display = 'none';
            document.getElementById('addDoctorModal').style.display = 'none';
            document.getElementById('addSpecialtyModal').style.display = 'none';
            document.getElementById('emailModal').style.display = 'none';
            document.getElementById('uploadOptionsModal').style.display = 'none';
            document.getElementById('allSchedulesModal').style.display = 'none';
            currentRow = -1;
            currentCol = -1;
            currentSpecialtyRow = -1;
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        function changeMonth() {
            const monthSelector = document.getElementById('monthSelector');
            currentMonth = parseInt(monthSelector.value);
            const daysInMonth = getDaysInMonth(currentMonth, currentYear);
            data[0] = ["Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ØµØ­Ù‰ Ø¨Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©"];
            for (let i = 1; i <= daysInMonth; i++) {
                data[0].push(i);
            }
            data[1] = [""];
            for (let i = 1; i <= daysInMonth; i++) {
                data[1].push(getDayName(i, currentMonth, currentYear));
            }
            data[2] = ["Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø¨Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ù† Ø¬Ù„ÙˆÙŠ "];
            for (let i = 1; i <= daysInMonth; i++) {
                data[2].push("Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„ØªØ®ØµØµ");
            }
            for (let rowIndex = 4; rowIndex < data.length; rowIndex++) {
                const currentRowLength = data[rowIndex].length - 1;
                if (currentRowLength < daysInMonth) {
                    for (let i = currentRowLength; i < daysInMonth; i++) {
                        data[rowIndex].push("");
                    }
                } else if (currentRowLength > daysInMonth) {
                    data[rowIndex] = data[rowIndex].slice(0, daysInMonth + 1);
                }
            }
            document.getElementById('headerTitle').textContent = 
                `Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© Ù„Ø´Ù‡Ø± ${monthNames[currentMonth]} ${currentYear}`;
            buildTable();
            autoSave();
        }

        async function exportToExcel() {
            const excelData = JSON.parse(JSON.stringify(data));
            
            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet('Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª');
            
            worksheet.addRows(excelData);
            
            worksheet.mergeCells('A1:A2');
            
            const borderStyle = {
                top: { style: 'thin', color: { argb: 'FF000000' } },
                left: { style: 'thin', color: { argb: 'FF000000' } },
                bottom: { style: 'thin', color: { argb: 'FF000000' } },
                right: { style: 'thin', color: { argb: 'FF000000' } }
            };
            
            for (let col = 1; col <= excelData[0].length; col++) {
                const cell1 = worksheet.getCell(1, col);
                cell1.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FF1F4E78' }
                };
                cell1.font = { color: { argb: 'FFFFFFFF' }, bold: true };
                cell1.alignment = { horizontal: 'center', vertical: 'middle' };
                cell1.border = borderStyle;
                
                const cell2 = worksheet.getCell(2, col);
                cell2.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FF1F4E78' }
                };
                cell2.font = { color: { argb: 'FFFFFFFF' }, bold: true };
                cell2.alignment = { horizontal: 'center', vertical: 'middle' };
                cell2.border = borderStyle;
            }
            
            for (let col = 1; col <= excelData[0].length; col++) {
                const cell3 = worksheet.getCell(3, col);
                
                if (col === 1) {
                    cell3.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'FFFFFFFF' }
                    };
                    cell3.font = { color: { argb: 'FF000000' }, bold: true };
                    cell3.alignment = { horizontal: 'right', vertical: 'middle' };
                } else {
                    cell3.fill = {
                        type: 'pattern',
                        pattern: 'solid',
                        fgColor: { argb: 'FF000000' }
                    };
                    cell3.font = { color: { argb: 'FFFFFFFF' }, bold: true };
                    cell3.alignment = { horizontal: 'center', vertical: 'middle' };
                }
                
                cell3.border = borderStyle;
            }
            
            for (let col = 1; col <= excelData[0].length; col++) {
                const cell4 = worksheet.getCell(4, col);
                cell4.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FF7F7F7F' }
                };
                cell4.font = { color: { argb: 'FFFFFFFF' }, bold: true };
                cell4.alignment = { horizontal: 'center', vertical: 'middle' };
                cell4.border = borderStyle;
            }
            
            for (let row = 5; row <= excelData.length; row++) {
                for (let col = 1; col <= excelData[0].length; col++) {
                    const cell = worksheet.getCell(row, col);
                    
                    if (col === 1) {
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FFB4C7E7' }
                        };
                        cell.font = { bold: true };
                        cell.alignment = { horizontal: 'right', vertical: 'middle' };
                    } else {
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FFD9D9D9' }
                        };
                        cell.alignment = { horizontal: 'center', vertical: 'middle' };
                    }
                    
                    cell.border = borderStyle;
                }
            }
            
            worksheet.getColumn(1).width = 35;
            for (let col = 2; col <= excelData[0].length; col++) {
                worksheet.getColumn(col).width = 12;
            }
            
            worksheet.views = [
                { state: 'frozen', xSplit: 1, ySplit: 4 }
            ];
            
            const buffer = await workbook.xlsx.writeBuffer();
            const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ø¬Ø¯ÙˆÙ„_Ø§Ù„ØªØ®ØµØµØ§Øª_Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©_${monthNames[currentMonth]}_${currentYear}.xlsx`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function showEmailModal() {
            const modal = document.getElementById('emailModal');
            modal.querySelector('.modal-header').textContent = 
                `ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙˆÙ„ Ù…Ù†Ø§ÙˆØ¨Ø§Øª ${monthNames[currentMonth]} ${currentYear}`;
            modal.style.display = 'block';
            document.getElementById('recipientEmail').value = '';
            selectedEmailService = '';
            document.querySelectorAll('input[name="emailService"]').forEach(radio => {
                radio.checked = false;
            });
        }

        function selectEmailOption(service) {
            selectedEmailService = service;
            document.getElementById(service + 'Option').checked = true;
        }

        function sendEmail() {
            const email = document.getElementById('recipientEmail').value.trim();
            if (!email) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
                return;
            }
            if (!selectedEmailService) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                return;
            }
            const subject = encodeURIComponent(`Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© Ù„Ø´Ù‡Ø± ${monthNames[currentMonth]} ${currentYear}`);
            const body = encodeURIComponent(`Ù…Ø±ÙÙ‚ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© Ù„Ø´Ù‡Ø± ${monthNames[currentMonth]} ${currentYear}.\n\nÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ÙÙ‚.`);
            let mailtoUrl = '';
            if (selectedEmailService === 'gmail') {
                mailtoUrl = `https://mail.google.com/mail/?view=cm&to=${email}&su=${subject}&body=${body}`;
            } else if (selectedEmailService === 'owa') {
                mailtoUrl = `https://owa.moh.gov.sa/owa/?ae=Item&t=IPM.Note&a=New&to=${email}&subject=${subject}&body=${body}`;
            }
            window.open(mailtoUrl, '_blank');
            closeModal();
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const fileName = file.name.toLowerCase();
            try {
                if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                    await handleExcelUpload(file);
                } else if (fileName.endsWith('.csv')) {
                    await handleCSVUpload(file);
                }
            } catch (error) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
                console.error(error);
            }
            event.target.value = '';
        }

        async function handleExcelUpload(file) {
            const arrayBuffer = await file.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer);
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: '' });
            uploadedFileData = jsonData;
            document.getElementById('uploadOptionsModal').style.display = 'block';
        }

        async function handleCSVUpload(file) {
            const text = await file.text();
            const lines = text.split('\n');
            const jsonData = lines.map(line => {
                const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
                return line.split(regex).map(cell => cell.replace(/^"|"$/g, '').trim());
            });
            uploadedFileData = jsonData;
            document.getElementById('uploadOptionsModal').style.display = 'block';
        }

        function selectOnCallType(type) {
            selectedOnCallType = type;
            document.getElementById(type === 'first' ? 'firstOnCallOption' : 
                                   type === 'second' ? 'secondOnCallOption' : 
                                   'bothOnCallOption').checked = true;
        }

        function processUploadedFile() {
            if (!uploadedFileData) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
                return;
            }
            let headerRow = -1;
            let dayCol = -1, dateCol = -1, specialtyCol = -1, firstOnCallCol = -1, secondOnCallCol = -1;
            for (let i = 0; i < Math.min(5, uploadedFileData.length); i++) {
                const row = uploadedFileData[i];
                for (let j = 0; j < row.length; j++) {
                    const cell = row[j].toString().toLowerCase().trim();
                    if (cell.includes('ÙŠÙˆÙ…') || cell.includes('day')) dayCol = j;
                    if (cell.includes('ØªØ§Ø±ÙŠØ®') || cell.includes('date')) dateCol = j;
                    if (cell.includes('ØªØ®ØµØµ') || cell.includes('specialty') || cell.includes('department')) specialtyCol = j;
                    if (cell.includes('Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø£ÙˆÙ„') || cell.includes('first') || cell.includes('Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø§ÙˆÙ„')) firstOnCallCol = j;
                    if (cell.includes('Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø«Ø§Ù†ÙŠ') || cell.includes('second') || cell.includes('Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø«Ø§Ù†ÙŠ')) secondOnCallCol = j;
                }
                if (specialtyCol !== -1 && (firstOnCallCol !== -1 || secondOnCallCol !== -1)) {
                    headerRow = i;
                    break;
                }
            }
            if (headerRow === -1) {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹');
                return;
            }
            const scheduleData = {};
            for (let i = headerRow + 1; i < uploadedFileData.length; i++) {
                const row = uploadedFileData[i];
                if (!row || row.length === 0 || !row[specialtyCol]) continue;
                const specialty = normalizeSpecialty(row[specialtyCol].toString().trim());
                const date = dateCol !== -1 ? row[dateCol] : '';
                let dayNumber = -1;
                if (date) {
                    const dateMatch = date.toString().match(/\d{4}-(\d{2})-(\d{2})/);
                    if (dateMatch) {
                        const month = parseInt(dateMatch[1]);
                        const day = parseInt(dateMatch[2]);
                        if (month === currentMonth) {
                            dayNumber = day;
                        }
                    }
                }
                if (dayNumber === -1) continue;
                let doctorName = '';
                if (selectedOnCallType === 'first' && firstOnCallCol !== -1) {
                    doctorName = row[firstOnCallCol] ? row[firstOnCallCol].toString().trim() : '';
                } else if (selectedOnCallType === 'second' && secondOnCallCol !== -1) {
                    doctorName = row[secondOnCallCol] ? row[secondOnCallCol].toString().trim() : '';
                } else if (selectedOnCallType === 'both') {
                    const first = firstOnCallCol !== -1 && row[firstOnCallCol] ? row[firstOnCallCol].toString().trim() : '';
                    const second = secondOnCallCol !== -1 && row[secondOnCallCol] ? row[secondOnCallCol].toString().trim() : '';
                    doctorName = first && second ? `${first} / ${second}` : (first || second);
                }
                if (!scheduleData[specialty]) {
                    scheduleData[specialty] = {};
                }
                scheduleData[specialty][dayNumber] = doctorName;
            }
            fillScheduleTable(scheduleData);
            closeModal();
            uploadedFileData = null;
            autoSave();
            alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…\nğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
        }

        function normalizeSpecialty(specialty) {
            const lower = specialty.toLowerCase().trim();
            if (specialtyTranslation[lower]) {
                return specialtyTranslation[lower];
            }
            for (let i = 4; i < data.length; i++) {
                const existingSpecialty = data[i][0].toLowerCase().trim();
                if (existingSpecialty === lower || 
                    existingSpecialty.includes(lower) || 
                    lower.includes(existingSpecialty)) {
                    return data[i][0];
                }
            }
            return specialty;
        }

        function fillScheduleTable(scheduleData) {
            for (const specialty in scheduleData) {
                let specialtyRowIndex = -1;
                for (let i = 4; i < data.length; i++) {
                    if (data[i][0].toLowerCase().trim() === specialty.toLowerCase().trim()) {
                        specialtyRowIndex = i;
                        break;
                    }
                }
                if (specialtyRowIndex === -1) {
                    const newRow = [specialty];
                    for (let i = 1; i <= 31; i++) {
                        newRow.push('');
                    }
                    data.push(newRow);
                    specialtyRowIndex = data.length - 1;
                }
                const dayData = scheduleData[specialty];
                for (const day in dayData) {
                    const dayIndex = parseInt(day);
                    if (dayIndex >= 1 && dayIndex <= data[0].length - 1) {
                        data[specialtyRowIndex][dayIndex] = dayData[day];
                        if (!specialtyDoctors[specialty]) {
                            specialtyDoctors[specialty] = [];
                        }
                        const doctorName = dayData[day];
                        if (doctorName && !specialtyDoctors[specialty].includes(doctorName) &&
                            doctorName !== 'not applicable' && doctorName !== 'NMT' && 
                            doctorName !== 'Not available') {
                            specialtyDoctors[specialty].push(doctorName);
                            specialtyDoctors[specialty].sort();
                        }
                    }
                }
            }
            buildTable();
            autoSave();
        }

        function restoreOriginalSchedule() {
            if (confirm('ğŸ“‹ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠØŸ\n\nØ³ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ­Ø°Ù Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.')) {
                localStorage.removeItem('scheduleData');
                initializeData();
                buildSpecialtyDoctors();
                buildTable();
                const statusDiv = document.getElementById('saveStatus');
                if (statusDiv) {
                    statusDiv.textContent = 'âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ';
                    statusDiv.style.color = '#4caf50';
                }
                alert('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ø¢Ù†.');
            }
        }

        function analyzeDataStructure(data) {
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ” ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('1ï¸âƒ£ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', typeof data);
            console.log('2ï¸âƒ£ Ù‡Ù„ Ù‡ÙŠ ArrayØŸ', Array.isArray(data));
            console.log('3ï¸âƒ£ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±:', data ? data.length : 0);
            if (data && data.length > 0) {
                console.log('\nğŸ“¦ ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ„ 3 Ø¹Ù†Ø§ØµØ±:');
                for (let i = 0; i < Math.min(3, data.length); i++) {
                    console.log(`\n[${i}] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`);
                    console.log('Ø§Ù„Ù†ÙˆØ¹:', typeof data[i]);
                    console.log('Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙƒØ§Ù…Ù„:');
                    console.log(JSON.stringify(data[i], null, 2));
                    if (typeof data[i] === 'object' && !Array.isArray(data[i])) {
                        console.log('Ø§Ù„Ù…ÙØ§ØªÙŠØ­:', Object.keys(data[i]));
                        if (data[i].cells) {
                            console.log('ØªÙØ§ØµÙŠÙ„ cells:');
                            if (Array.isArray(data[i].cells)) {
                                console.log('  - Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§:', data[i].cells.length);
                                console.log('  - Ø£ÙˆÙ„ Ø®Ù„ÙŠØ©:', data[i].cells[0]);
                                console.log('  - Ù†ÙˆØ¹ Ø£ÙˆÙ„ Ø®Ù„ÙŠØ©:', typeof data[i].cells[0]);
                            }
                        }
                    }
                }
                if (typeof data[0] === 'object' && !Array.isArray(data[0])) {
                    const allKeys = new Set();
                    data.forEach(item => {
                        if (item && typeof item === 'object') {
                            Object.keys(item).forEach(key => allKeys.add(key));
                        }
                    });
                    console.log('\nğŸ”‘ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:');
                    console.log(Array.from(allKeys).sort());
                }
            }
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');
        }

        function convertVerticalToHorizontal(verticalData, scheduleInfo) {
            try {
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                analyzeDataStructure(verticalData);
                if (!verticalData) {
                    throw new Error('âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© (null/undefined)');
                }
                if (!Array.isArray(verticalData)) {
                    console.log('âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙŠØ³Øª ArrayØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„...');
                    if (typeof verticalData === 'object') {
                        verticalData = Object.values(verticalData);
                    } else {
                        throw new Error('âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©: ' + typeof verticalData);
                    }
                }
                if (verticalData.length === 0) {
                    throw new Error('âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ© (length = 0)');
                }
                const firstItem = verticalData[0];
                if (typeof firstItem === 'object' && !Array.isArray(firstItem) && firstItem !== null) {
                    console.log('â¡ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Objects');
                    return convertObjectsToHorizontal(verticalData);
                } else if (Array.isArray(firstItem)) {
                    console.log('â¡ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Arrays');
                    return convertArraysToHorizontal(verticalData);
                } else {
                    throw new Error('âŒ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…: ' + typeof firstItem);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ convertVerticalToHorizontal:', error.message);
                throw error;
            }
        }

        function convertObjectsToHorizontal(objectData) {
            console.log('ğŸ”„ ØªØ­ÙˆÙŠÙ„ Objects Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø¹Ø±Ø¶ÙŠØ©...');
            const allKeys = new Set();
            objectData.forEach(item => {
                if (item && typeof item === 'object') {
                    Object.keys(item).forEach(key => allKeys.add(key));
                }
            });
            console.log('ğŸ”‘ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…ØªØ§Ø­Ø©:', Array.from(allKeys));
            if (allKeys.has('cells') || allKeys.has('html')) {
                console.log('ğŸ¯ Ø§ÙƒØªØ´Ø§Ù ØªÙ†Ø³ÙŠÙ‚ Cells - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø§Ù„Ø¬ Ø®Ø§Øµ');
                return convertCellsFormatToHorizontal(objectData);
            }
            const specialtyFields = [
                'specialty', 'Ø§Ù„ØªØ®ØµØµ', 'department', 'specialtyName', 'ØªØ®ØµØµ',
                'Specialty', 'SPECIALTY', 'spec', 'dept'
            ];
            const dateFields = [
                'date', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'dateValue', 'ØªØ§Ø±ÙŠØ®', 'Date', 'DATE',
                'day', 'Ø§Ù„ÙŠÙˆÙ…', 'dayNumber', 'Ø±Ù‚Ù…_Ø§Ù„ÙŠÙˆÙ…'
            ];
            const doctorFields = [
                'firstOnCall', 'Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ù…Ù†Ø§ÙˆØ¨ Ø§Ù„Ø§ÙˆÙ„', 'Ø§Ù„Ù…Ù†Ø§ÙˆØ¨_Ø§Ù„Ø§ÙˆÙ„',
                'doctor', 'Ø§Ù„Ù…Ù†Ø§ÙˆØ¨', 'oncall', 'on_call', 'first_on_call',
                'doctorName', 'Ø§Ø³Ù…_Ø§Ù„Ø·Ø¨ÙŠØ¨', 'physician', 'Ø§Ù„Ø·Ø¨ÙŠØ¨'
            ];
            let specialtyKey = null, dateKey = null, doctorKey = null;
            for (const key of allKeys) {
                const lowerKey = key.toLowerCase();
                if (!specialtyKey && specialtyFields.some(f => lowerKey.includes(f.toLowerCase()))) {
                    specialtyKey = key;
                }
                if (!dateKey && dateFields.some(f => lowerKey.includes(f.toLowerCase()))) {
                    dateKey = key;
                }
                if (!doctorKey && doctorFields.some(f => lowerKey.includes(f.toLowerCase()))) {
                    doctorKey = key;
                }
            }
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ¯ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©:');
            console.log('   - Ø§Ù„ØªØ®ØµØµ:', specialtyKey || 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            console.log('   - Ø§Ù„ØªØ§Ø±ÙŠØ®:', dateKey || 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            console.log('   - Ø§Ù„Ù…Ù†Ø§ÙˆØ¨:', doctorKey || 'âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            if (!specialtyKey) {
                throw new Error(`âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„ØªØ®ØµØµ\n\nØ§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…ØªØ§Ø­Ø©:\n${Array.from(allKeys).join(', ')}`);
            }
            if (!doctorKey) {
                throw new Error(`âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ù…Ù†Ø§ÙˆØ¨\n\nØ§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…ØªØ§Ø­Ø©:\n${Array.from(allKeys).join(', ')}`);
            }
            const specialtySchedules = {};
            let processedRows = 0;
            let skippedRows = 0;
            for (let i = 0; i < objectData.length; i++) {
                const row = objectData[i];
                let specialty = row[specialtyKey] ? row[specialtyKey].toString().trim() : '';
                if (!specialty) {
                    skippedRows++;
                    continue;
                }
                specialty = normalizeSpecialty(specialty);
                let dayNumber = -1;
                if (dateKey) {
                    const dateValue = row[dateKey] ? row[dateKey].toString().trim() : '';
                    dayNumber = extractDayFromDate(dateValue);
                }
                if (dayNumber === -1) {
                    for (const key in row) {
                        if (key === specialtyKey || key === doctorKey) continue;
                        const value = row[key];
                        if (typeof value === 'number' && value >= 1 && value <= 31) {
                            dayNumber = value;
                            break;
                        }
                    }
                }
                if (dayNumber === -1) {
                    skippedRows++;
                    continue;
                }
                const doctorName = row[doctorKey] ? row[doctorKey].toString().trim() : '';
                if (!specialtySchedules[specialty]) {
                    specialtySchedules[specialty] = {};
                }
                specialtySchedules[specialty][dayNumber] = doctorName;
                processedRows++;
                if (processedRows <= 5) {
                    console.log(`âœ… ØµÙ ${i}: ${specialty} - ÙŠÙˆÙ… ${dayNumber} - ${doctorName || '(ÙØ§Ø±Øº)'}`);
                }
            }
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:');
            console.log('   - ØµÙÙˆÙ Ù…Ø¹Ø§Ù„Ø¬Ø©: ' + processedRows);
            console.log('   - ØµÙÙˆÙ Ù…ØªØ¬Ø§Ù‡Ù„Ø©: ' + skippedRows);
            console.log('   - ØªØ®ØµØµØ§Øª: ' + Object.keys(specialtySchedules).length);
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            if (Object.keys(specialtySchedules).length === 0) {
                throw new Error(`âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©`);
            }
            return convertSchedulesToHorizontal(specialtySchedules);
        }

        function convertCellsFormatToHorizontal(objectData) {
            console.log('ğŸ”„ ØªØ­ÙˆÙŠÙ„ ØªÙ†Ø³ÙŠÙ‚ Cells Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø¹Ø±Ø¶ÙŠØ©...');
            console.log('ğŸ“¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙˆÙ:', objectData.length);
            if (objectData.length > 0 && objectData[0].cells) {
                console.log('ğŸ“‹ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:');
                console.log('   Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„:', objectData[0].cells);
            }
            const specialtySchedules = {};
            let processedRows = 0;
            let skippedRows = 0;
            for (let i = 0; i < objectData.length; i++) {
                const row = objectData[i];
                if (!row.cells || !Array.isArray(row.cells) || row.cells.length < 4) {
                    skippedRows++;
                    continue;
                }
                const cells = row.cells;
                const dayName = cells[0] || '';
                const dateStr = cells[1] || '';
                const specialty = cells[2] || '';
                const doctorName = cells[3] || '';
                if (!specialty || !dateStr) {
                    skippedRows++;
                    continue;
                }
                const dayNumber = extractDayFromDate(dateStr);
                if (dayNumber === -1) {
                    console.log(`âš ï¸ ØµÙ ${i}: Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… Ù…Ù† "${dateStr}"`);
                    skippedRows++;
                    continue;
                }
                const normalizedSpecialty = normalizeSpecialty(specialty);
                if (!specialtySchedules[normalizedSpecialty]) {
                    specialtySchedules[normalizedSpecialty] = {};
                }
                specialtySchedules[normalizedSpecialty][dayNumber] = doctorName;
                processedRows++;
                if (processedRows <= 5) {
                    console.log(`âœ… ØµÙ ${i}: ${normalizedSpecialty} - ÙŠÙˆÙ… ${dayNumber} (${dateStr}) - ${doctorName || '(ÙØ§Ø±Øº)'}`);
                }
            }
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:');
            console.log('   - ØµÙÙˆÙ Ù…Ø¹Ø§Ù„Ø¬Ø©: ' + processedRows);
            console.log('   - ØµÙÙˆÙ Ù…ØªØ¬Ø§Ù‡Ù„Ø©: ' + skippedRows);
            console.log('   - ØªØ®ØµØµØ§Øª: ' + Object.keys(specialtySchedules).length);
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            if (Object.keys(specialtySchedules).length === 0) {
                throw new Error(`âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©\nØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© ${objectData.length} ØµÙ`);
            }
            return convertSchedulesToHorizontal(specialtySchedules);
        }

        function convertArraysToHorizontal(arrayData) {
            console.log('ğŸ”„ ØªØ­ÙˆÙŠÙ„ Arrays Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø¹Ø±Ø¶ÙŠØ©...');
            let headerRow = -1;
            let specialtyCol = -1, dateCol = -1, doctorCol = -1;
            const specialtyKeywords = ['ØªØ®ØµØµ', 'specialty', 'department'];
            const dateKeywords = ['ØªØ§Ø±ÙŠØ®', 'date', 'ÙŠÙˆÙ…'];
            const doctorKeywords = ['Ù…Ù†Ø§ÙˆØ¨', 'doctor', 'oncall', 'first'];
            for (let i = 0; i < Math.min(15, arrayData.length); i++) {
                const row = arrayData[i];
                if (!row || row.length === 0) continue;
                let foundSpecialty = false, foundDoctor = false;
                for (let j = 0; j < row.length; j++) {
                    const cell = row[j] ? row[j].toString().toLowerCase().trim() : '';
                    if (!foundSpecialty && specialtyKeywords.some(kw => cell.includes(kw))) {
                        specialtyCol = j;
                        foundSpecialty = true;
                    }
                    if (dateKeywords.some(kw => cell.includes(kw))) {
                        dateCol = j;
                    }
                    if (!foundDoctor && doctorKeywords.some(kw => cell.includes(kw))) {
                        doctorCol = j;
                        foundDoctor = true;
                    }
                }
                if (foundSpecialty && foundDoctor) {
                    headerRow = i;
                    break;
                }
            }
            if (headerRow === -1 || specialtyCol === -1 || doctorCol === -1) {
                throw new Error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†');
            }
            const specialtySchedules = {};
            let processedRows = 0;
            for (let i = headerRow + 1; i < arrayData.length; i++) {
                const row = arrayData[i];
                if (!row || row.length === 0) continue;
                let specialty = row[specialtyCol] ? row[specialtyCol].toString().trim() : '';
                if (!specialty) continue;
                specialty = normalizeSpecialty(specialty);
                const dateValue = row[dateCol] ? row[dateCol].toString().trim() : '';
                const dayNumber = extractDayFromDate(dateValue);
                if (dayNumber === -1) continue;
                const doctorName = row[doctorCol] ? row[doctorCol].toString().trim() : '';
                if (!specialtySchedules[specialty]) {
                    specialtySchedules[specialty] = {};
                }
                specialtySchedules[specialty][dayNumber] = doctorName;
                processedRows++;
            }
            if (Object.keys(specialtySchedules).length === 0) {
                throw new Error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©');
            }
            return convertSchedulesToHorizontal(specialtySchedules);
        }

        function extractDayFromDate(dateValue) {
            if (!dateValue) return -1;
            const dateStr = dateValue.toString().trim();
            let match = dateStr.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);
            if (match) {
                const year = parseInt(match[1]);
                const month = parseInt(match[2]);
                const day = parseInt(match[3]);
                if (day >= 1 && day <= 31) {
                    return day;
                }
            }
            if (/^\d{1,2}$/.test(dateStr)) {
                const day = parseInt(dateStr);
                if (day >= 1 && day <= 31) {
                    return day;
                }
            }
            match = dateStr.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);
            if (match) {
                const day = parseInt(match[1]);
                if (day >= 1 && day <= 31) {
                    return day;
                }
            }
            try {
                const date = new Date(dateStr);
                if (!isNaN(date.getTime())) {
                    const day = date.getDate();
                    if (day >= 1 && day <= 31) {
                        return day;
                    }
                }
            } catch (e) {}
            return -1;
        }

        function convertSchedulesToHorizontal(specialtySchedules) {
            const daysInMonth = getDaysInMonth(currentMonth, currentYear);
            const horizontalData = [];
            console.log('ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø¹Ø±Ø¶ÙŠØ©...');
            for (const specialty in specialtySchedules) {
                const row = [specialty];
                for (let day = 1; day <= daysInMonth; day++) {
                    const doctorName = specialtySchedules[specialty][day] || '';
                    row.push(doctorName);
                }
                horizontalData.push(row);
            }
            console.log('âœ… ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
            console.log('ğŸ“ˆ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª:', horizontalData.length);
            return horizontalData;
        }

        function updateExistingScheduleData(convertedData) {
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©...');
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            let updatedCount = 0;
            let notFoundCount = 0;
            const notFoundSpecialties = [];
            for (let cloudRow of convertedData) {
                const cloudSpecialty = cloudRow[0];
                let foundRowIndex = -1;
                for (let i = 4; i < data.length; i++) {
                    const existingSpecialty = data[i][0];
                    if (existingSpecialty.toLowerCase().trim() === cloudSpecialty.toLowerCase().trim()) {
                        foundRowIndex = i;
                        break;
                    }
                    if (normalizeSpecialty(existingSpecialty) === normalizeSpecialty(cloudSpecialty)) {
                        foundRowIndex = i;
                        break;
                    }
                    if (existingSpecialty.toLowerCase().includes(cloudSpecialty.toLowerCase()) ||
                        cloudSpecialty.toLowerCase().includes(existingSpecialty.toLowerCase())) {
                        foundRowIndex = i;
                        break;
                    }
                }
                if (foundRowIndex !== -1) {
                    const existingSpecialtyName = data[foundRowIndex][0];
                    for (let dayIndex = 1; dayIndex < cloudRow.length && dayIndex < data[foundRowIndex].length; dayIndex++) {
                        const doctorName = cloudRow[dayIndex];
                        if (doctorName) {
                            data[foundRowIndex][dayIndex] = doctorName;
                            if (!specialtyDoctors[existingSpecialtyName]) {
                                specialtyDoctors[existingSpecialtyName] = [];
                            }
                            if (!specialtyDoctors[existingSpecialtyName].includes(doctorName) &&
                                doctorName !== 'Not available' && 
                                doctorName !== 'NMT' && 
                                doctorName !== 'not applicable') {
                                specialtyDoctors[existingSpecialtyName].push(doctorName);
                                specialtyDoctors[existingSpecialtyName].sort();
                            }
                        }
                    }
                    updatedCount++;
                    console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ«: ${existingSpecialtyName} â† Ù…Ù† â†’ ${cloudSpecialty}`);
                } else {
                    notFoundCount++;
                    notFoundSpecialties.push(cloudSpecialty);
                    console.log(`âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰: ${cloudSpecialty}`);
                }
            }
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            console.log('ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ«:');
            console.log(`   âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${updatedCount} ØªØ®ØµØµ`);
            console.log(`   âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡: ${notFoundCount} ØªØ®ØµØµ`);
            if (notFoundSpecialties.length > 0) {
                console.log('   ğŸ“‹ Ø§Ù„ØªØ®ØµØµØ§Øª ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:', notFoundSpecialties.join(', '));
            }
            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
            return updatedCount;
        }

        async function loadScheduleFromCloud() {
            if (!window.firebaseReady) {
                alert('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØµÙ„!\nØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                return;
            }
            const cloudInfo = document.getElementById('cloudInfo');
            cloudInfo.style.display = 'block';
            cloudInfo.querySelector('#cloudInfoText').textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...';
            try {
                console.log(`ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø¯Ø§ÙˆÙ„: ${monthNames[currentMonth]} ${currentYear}`);
                const schedulesRef = window.fbCollection(window.db, 'schedules');
                const snapshot = await window.fbGetDocs(schedulesRef);
                let foundSchedules = [];
                snapshot.forEach((doc) => {
                    const scheduleData = doc.data();
                    const scheduleName = scheduleData.scheduleName || scheduleData.name || doc.id;
                    const specialty = scheduleData.specialty || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const scheduleMonth = parseInt(scheduleData.month) + 1;
                    const scheduleYear = parseInt(scheduleData.year);
                    if (scheduleMonth === currentMonth && scheduleYear === currentYear) {
                        if (scheduleData.scheduleTable || scheduleData.rows) {
                            foundSchedules.push({
                                id: doc.id,
                                name: scheduleName,
                                specialty: specialty,
                                data: scheduleData
                            });
                        }
                    }
                });
                if (foundSchedules.length === 0) {
                    throw new Error(`Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ø¯Ø§ÙˆÙ„ Ù„Ø´Ù‡Ø± ${monthNames[currentMonth]} ${currentYear}`);
                }
                let selectedSchedule;
                if (foundSchedules.length === 1) {
                    selectedSchedule = foundSchedules[0].data;
                } else {
                    const options = foundSchedules.map((s, i) => 
                        `${i + 1}. ${s.name} (${s.specialty})`
                    ).join('\n');
                    const choice = prompt(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${foundSchedules.length} Ø¬Ø¯Ø§ÙˆÙ„:\n\n${options}\n\nØ£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„:`);
                    if (!choice) {
                        cloudInfo.style.display = 'none';
                        return;
                    }
                    const index = parseInt(choice) - 1;
                    if (index < 0 || index >= foundSchedules.length) {
                        throw new Error('Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­');
                    }
                    selectedSchedule = foundSchedules[index].data;
                }
                let cloudData = selectedSchedule.scheduleTable || selectedSchedule.rows;
                if (!cloudData || cloudData.length === 0) {
                    throw new Error('Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                const convertedData = convertVerticalToHorizontal(cloudData, selectedSchedule);
                let updatedCount = updateExistingScheduleData(convertedData);
                buildSpecialtyDoctors();
                buildTable();
                const scheduleName = selectedSchedule.scheduleName || selectedSchedule.name || 'Ø§Ù„Ø¬Ø¯ÙˆÙ„';
                cloudInfo.querySelector('#cloudInfoText').innerHTML = `
                    âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br>
                    ğŸ“‹ ${scheduleName}<br>
                    ğŸ“… ${monthNames[currentMonth]} ${currentYear}<br>
                    ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedCount} ØªØ®ØµØµ
                `;
                setTimeout(() => cloudInfo.style.display = 'none', 5000);
                alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“‹ ${scheduleName}\nğŸ“… ${monthNames[currentMonth]} ${currentYear}\nğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedCount} ØªØ®ØµØµ`);
                autoSave();
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                cloudInfo.querySelector('#cloudInfoText').innerHTML = `âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„<br>${error.message}`;
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£:\n\n' + error.message);
            }
        }

        async function showAllSchedules() {
            if (!window.firebaseReady) {
                alert('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØµÙ„!');
                return;
            }
            const modal = document.getElementById('allSchedulesModal');
            const listDiv = document.getElementById('allSchedulesList');
            modal.style.display = 'block';
            listDiv.innerHTML = '<p style="text-align: center; color: #666;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            try {
                const schedulesRef = window.fbCollection(window.db, 'schedules');
                const snapshot = await window.fbGetDocs(schedulesRef);
                let allSchedules = [];
                snapshot.forEach((doc) => {
                    const scheduleData = doc.data();
                    const scheduleName = scheduleData.scheduleName || scheduleData.name || doc.id;
                    const specialty = scheduleData.specialty || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const scheduleMonth = parseInt(scheduleData.month) + 1;
                    const scheduleYear = parseInt(scheduleData.year);
                    if (scheduleData.scheduleTable || scheduleData.rows) {
                        allSchedules.push({
                            id: doc.id,
                            name: scheduleName,
                            specialty: specialty,
                            month: scheduleMonth,
                            year: scheduleYear,
                            data: scheduleData
                        });
                    }
                });
                if (allSchedules.length === 0) {
                    listDiv.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“­</div>
                            <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø­ÙÙˆØ¸Ø©</p>
                        </div>
                    `;
                    return;
                }
                allSchedules.sort((a, b) => {
                    if (a.year !== b.year) return b.year - a.year;
                    return b.month - a.month;
                });
                let html = '<div style="display: grid; gap: 15px;">';
                allSchedules.forEach((schedule) => {
                    const monthName = monthNames[schedule.month] || schedule.month;
                    html += `
                        <div style="
                            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
                            padding: 20px;
                            border-radius: 12px;
                            border-right: 5px solid #667eea;
                            cursor: pointer;
                            transition: all 0.3s;
                        "
                        onclick="loadSpecificSchedule('${schedule.id}')">
                            <h3 style="color: #667eea;">ğŸ“‹ ${schedule.name}</h3>
                            <p style="color: #666;">ğŸ¥ ${schedule.specialty}</p>
                            <p style="color: #888;">ğŸ“… ${monthName} ${schedule.year}</p>
                        </div>
                    `;
                });
                html += '</div>';
                listDiv.innerHTML = html;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                listDiv.innerHTML = `<div style="text-align: center; color: #f44336;">âš ï¸ ${error.message}</div>`;
            }
        }

        async function loadSpecificSchedule(scheduleId) {
            if (!window.firebaseReady) {
                alert('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØµÙ„!');
                return;
            }
            closeModal();
            const cloudInfo = document.getElementById('cloudInfo');
            cloudInfo.style.display = 'block';
            cloudInfo.querySelector('#cloudInfoText').textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„...';
            try {
                const schedulesRef = window.fbCollection(window.db, 'schedules');
                const snapshot = await window.fbGetDocs(schedulesRef);
                let selectedSchedule = null;
                snapshot.forEach((doc) => {
                    if (doc.id === scheduleId) {
                        selectedSchedule = doc.data();
                    }
                });
                if (!selectedSchedule) {
                    throw new Error('Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                }
                let cloudData = null;
                if (selectedSchedule.scheduleTable && selectedSchedule.scheduleTable.length > 0) {
                    cloudData = selectedSchedule.scheduleTable;
                } else if (selectedSchedule.rows && selectedSchedule.rows.length > 0) {
                    cloudData = selectedSchedule.rows;
                } else {
                    for (const key in selectedSchedule) {
                        if (Array.isArray(selectedSchedule[key]) && selectedSchedule[key].length > 0) {
                            cloudData = selectedSchedule[key];
                            break;
                        }
                    }
                }
                if (!cloudData || cloudData.length === 0) {
                    throw new Error('Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                const originalMonth = parseInt(selectedSchedule.month);
                currentMonth = originalMonth + 1;
                currentYear = parseInt(selectedSchedule.year);
                document.getElementById('monthSelector').value = currentMonth;
                const convertedData = convertVerticalToHorizontal(cloudData, selectedSchedule);
                let updatedCount = updateExistingScheduleData(convertedData);
                changeMonth();
                buildSpecialtyDoctors();
                buildTable();
                const scheduleName = selectedSchedule.scheduleName || selectedSchedule.name || 'Ø§Ù„Ø¬Ø¯ÙˆÙ„';
                cloudInfo.querySelector('#cloudInfoText').innerHTML = `
                    âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br>
                    ğŸ“‹ ${scheduleName}<br>
                    ğŸ“… ${monthNames[currentMonth]} ${currentYear}<br>
                    ğŸ“Š ${convertedData.length} ØªØ®ØµØµ
                `;
                setTimeout(() => cloudInfo.style.display = 'none', 5000);
                alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„!\n\nğŸ“‹ ${scheduleName}\nğŸ“… ${monthNames[currentMonth]} ${currentYear}\nğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedCount} ØªØ®ØµØµ`);
                autoSave();
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                cloudInfo.querySelector('#cloudInfoText').innerHTML = `âš ï¸ Ø®Ø·Ø£<br>${error.message}`;
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£:\n\n' + error.message);
            }
        }

        async function loadCloudDataForSpecialty(rowIndex, specialtyName) {
            if (!window.firebaseReady) {
                alert('Firebase ØºÙŠØ± Ù…ØªØµÙ„!');
                return;
            }
            try {
                console.log('Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø¯Ø§ÙˆÙ„ Ù„ØªØ®ØµØµ: ' + specialtyName);
                const schedulesRef = window.fbCollection(window.db, 'schedules');
                const snapshot = await window.fbGetDocs(schedulesRef);
                let availableSchedules = [];
                snapshot.forEach((doc) => {
                    const scheduleData = doc.data();
                    if (scheduleData.scheduleTable || scheduleData.rows) {
                        const scheduleName = scheduleData.scheduleName || scheduleData.name || doc.id;
                        const specialty = scheduleData.specialty || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const scheduleMonth = parseInt(scheduleData.month) + 1;
                        const scheduleYear = parseInt(scheduleData.year);
                        availableSchedules.push({
                            id: doc.id,
                            name: scheduleName,
                            specialty: specialty,
                            month: scheduleMonth,
                            year: scheduleYear,
                            monthName: monthNames[scheduleMonth],
                            data: scheduleData
                        });
                    }
                });
                if (availableSchedules.length === 0) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    return;
                }
                availableSchedules.sort((a, b) => {
                    if (a.year !== b.year) return b.year - a.year;
                    return b.month - a.month;
                });
                let optionsText = 'Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©:\n\n';
                availableSchedules.forEach((s, i) => {
                    optionsText += (i + 1) + '. ' + s.name + ' (' + s.specialty + ') - ' + s.monthName + ' ' + s.year + '\n';
                });
                optionsText += '\nØ£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªØ­Ù…ÙŠÙ„Ù‡ ÙÙŠ ØªØ®ØµØµ "' + specialtyName + '":';
                const choice = prompt(optionsText);
                if (!choice) return;
                const index = parseInt(choice) - 1;
                if (index < 0 || index >= availableSchedules.length || isNaN(index)) {
                    alert('Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­');
                    return;
                }
                const selectedSchedule = availableSchedules[index].data;
                let cloudData = selectedSchedule.scheduleTable || selectedSchedule.rows;
                if (!cloudData || cloudData.length === 0) {
                    alert('Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
                    return;
                }
                console.log('ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                const convertedData = convertVerticalToHorizontal(cloudData, selectedSchedule);
                if (!convertedData || convertedData.length === 0) {
                    alert('ÙØ´Ù„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                    return;
                }
                const firstCloudSpecialty = convertedData[0];
                if (!firstCloudSpecialty || firstCloudSpecialty.length < 2) {
                    alert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©');
                    return;
                }
                const daysInMonth = getDaysInMonth(currentMonth, currentYear);
                const originalSpecialtyName = data[rowIndex][0];
                let updatedDays = 0;
                for (let dayIndex = 1; dayIndex <= daysInMonth; dayIndex++) {
                    if (dayIndex < firstCloudSpecialty.length) {
                        const doctorName = firstCloudSpecialty[dayIndex] || '';
                        data[rowIndex][dayIndex] = doctorName;
                        if (doctorName) {
                            updatedDays++;
                            if (!specialtyDoctors[originalSpecialtyName]) {
                                specialtyDoctors[originalSpecialtyName] = [];
                            }
                            if (!specialtyDoctors[originalSpecialtyName].includes(doctorName) &&
                                doctorName !== 'Not available' && 
                                doctorName !== 'NMT' && 
                                doctorName !== 'not applicable') {
                                specialtyDoctors[originalSpecialtyName].push(doctorName);
                                specialtyDoctors[originalSpecialtyName].sort();
                            }
                        }
                    }
                }
                buildTable();
                autoSave();
                const scheduleName = selectedSchedule.scheduleName || selectedSchedule.name || 'Ø§Ù„Ø¬Ø¯ÙˆÙ„';
                alert(
                    'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!\n\n' +
                    'Ù…Ù†: ' + scheduleName + '\n' +
                    'Ø¥Ù„Ù‰: ' + originalSpecialtyName + '\n' +
                    'ØªÙ… ØªØ­Ø¯ÙŠØ«: ' + updatedDays + ' ÙŠÙˆÙ…'
                );
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + updatedDays + ' ÙŠÙˆÙ… Ù„ØªØ®ØµØµ ' + originalSpecialtyName);
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£:\n\n' + error.message);
            }
        }

        function saveData() {
            try {
                const saveObject = {
                    data: data,
                    specialtyDoctors: specialtyDoctors,
                    currentMonth: currentMonth,
                    currentYear: currentYear,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('scheduleData', JSON.stringify(saveObject));
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                showSaveStatus();
            } catch (error) {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + error.message);
            }
        }

        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('scheduleData');
                if (savedData) {
                    const saveObject = JSON.parse(savedData);
                    data = saveObject.data;
                    specialtyDoctors = saveObject.specialtyDoctors;
                    currentMonth = saveObject.currentMonth || 10;
                    currentYear = saveObject.currentYear || 2025;
                    document.getElementById('monthSelector').value = currentMonth;
                    document.getElementById('headerTitle').textContent = 
                        `Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø© Ù„Ø´Ù‡Ø± ${monthNames[currentMonth]} ${currentYear}`;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©');
                    setTimeout(() => {
                        const saveDate = new Date(saveObject.timestamp);
                        const statusDiv = document.getElementById('saveStatus');
                        if (statusDiv) {
                            statusDiv.textContent = `âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ${saveDate.toLocaleString('ar-SA')}`;
                            statusDiv.style.color = '#4caf50';
                        }
                    }, 500);
                    return true;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
            return false;
        }

        function clearSavedData() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ\nØ³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙØ±ÙŠØº ÙƒÙ„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§.')) {
                for (let rowIndex = 4; rowIndex < data.length; rowIndex++) {
                    for (let colIndex = 1; colIndex < data[rowIndex].length; colIndex++) {
                        data[rowIndex][colIndex] = '';
                    }
                }
                Object.keys(specialtyDoctors).forEach(specialty => {
                    specialtyDoctors[specialty] = [];
                });
                localStorage.removeItem('scheduleData');
                buildTable();
                const statusDiv = document.getElementById('saveStatus');
                if (statusDiv) {
                    statusDiv.textContent = 'ğŸ—‘ï¸ ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ø¬Ø¯ÙˆÙ„';
                    statusDiv.style.color = '#f44336';
                }
                alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
            }
        }

        function autoSave() {
            try {
                const saveObject = {
                    data: data,
                    specialtyDoctors: specialtyDoctors,
                    currentMonth: currentMonth,
                    currentYear: currentYear,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('scheduleData', JSON.stringify(saveObject));
                console.log('ğŸ’¾ Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ:', new Date().toLocaleTimeString('ar-SA'));
                const statusDiv = document.getElementById('saveStatus');
                if (statusDiv) {
                    statusDiv.textContent = `ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸: ${new Date().toLocaleTimeString('ar-SA')}`;
                    statusDiv.style.color = '#4caf50';
                    setTimeout(() => {
                        statusDiv.style.opacity = '0.6';
                    }, 3000);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
            }
        }

        function showSaveStatus() {
            const savedData = localStorage.getItem('scheduleData');
            if (savedData) {
                const saveObject = JSON.parse(savedData);
                const saveDate = new Date(saveObject.timestamp);
                const statusDiv = document.getElementById('saveStatus');
                if (statusDiv) {
                    statusDiv.textContent = `Ø¢Ø®Ø± Ø­ÙØ¸: ${saveDate.toLocaleString('ar-SA')}`;
                }
            }
        }
    </script>
</body>
</html>